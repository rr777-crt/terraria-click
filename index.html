<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ë–ª–æ—á–Ω—ã–π –ú–µ–≥–∞–ø–æ–ª–∏—Å</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
            background-image: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #333;
        }
        #game-container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: rgba(255, 255, 255, 0.9);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 25px;
            font-size: 2.5em;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        #stats {
            display: flex;
            justify-content: space-around;
            background-color: #2c3e50;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .stat {
            font-size: 18px;
            font-weight: bold;
            display: flex;
            align-items: center;
        }
        .stat-icon {
            margin-right: 8px;
            font-size: 20px;
        }
        #shop {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        .shop-item {
            padding: 12px;
            border: 2px solid #3498db;
            background-color: white;
            cursor: pointer;
            text-align: center;
            border-radius: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        .shop-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            background-color: #f8f9fa;
        }
        .shop-item:active {
            transform: translateY(1px);
        }
        .shop-item.selected {
            background-color: #3498db;
            color: white;
            border-color: #2980b9;
        }
        #boards-container {
            display: flex;
            flex-wrap: wrap;
            gap: 25px;
            justify-content: center;
        }
        .board-container {
            position: relative;
        }
        .board-title {
            text-align: center;
            margin-bottom: 8px;
            font-weight: bold;
            color: #2c3e50;
            font-size: 1.2em;
        }
        .board {
            position: relative;
            width: 300px;
            height: 200px;
            border: 3px solid #95a5a6;
            background-color: #ecf0f1;
            overflow: hidden;
            border-radius: 8px;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.1);
        }
        .board.dirty {
            background-color: #d5dbdb;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.2);
        }
        .block {
            position: absolute;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .block:hover {
            transform: scale(1.05);
            z-index: 10;
        }
        .basic-block {
            background-color: #2ecc71;
            border: 2px solid #27ae60;
        }
        .metal-block {
            background-color: #95a5a6;
            border: 2px solid #7f8c8d;
        }
        .pump {
            background-color: #1abc9c;
            border: 2px solid #16a085;
        }
        .mover {
            background-color: #e74c3c;
            border: 2px solid #c0392b;
            border-radius: 50%;
        }
        .mech-pump {
            background-color: #3498db;
            border: 2px solid #2980b9;
        }
        .water-pump {
            background-color: #9b59b6;
            border: 2px solid #8e44ad;
            border-radius: 50%;
        }
        .trigger {
            background-color: #f39c12;
            border: 2px solid #d35400;
            clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
        }
        .construction-block {
            background-color: #34495e;
            border: 2px solid #2c3e50;
        }
        .bank {
            background-color: #f1c40f;
            border: 2px solid #f39c12;
        }
        .house {
            background-color: #e74c3c;
            border: 2px solid #c0392b;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path fill="%23ffffff" d="M50 10L90 50H75V90H60V70H40V90H25V50H10L50 10z"/></svg>');
            background-size: 60%;
            background-position: center;
            background-repeat: no-repeat;
        }
        .dirty-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.3);
            pointer-events: none;
        }
        .delete-mode {
            background-color: #e74c3c !important;
            color: white !important;
            border-color: #c0392b !important;
        }
        .progress-bar {
            height: 5px;
            background-color: #ecf0f1;
            border-radius: 3px;
            margin-top: 5px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background-color: #2ecc71;
            width: 0%;
            transition: width 0.3s;
        }
        #money-bar {
            position: relative;
            height: 10px;
            background-color: #ecf0f1;
            border-radius: 5px;
            margin-top: 10px;
            overflow: hidden;
        }
        #money-fill {
            height: 100%;
            background-color: #2ecc71;
            width: 0%;
            transition: width 0.3s;
        }
        #money-limit {
            position: absolute;
            right: 0;
            top: -20px;
            font-size: 12px;
            color: #7f8c8d;
        }
        .water-pump-clicks {
            position: absolute;
            bottom: -15px;
            left: 0;
            width: 100%;
            text-align: center;
            font-size: 10px;
            color: #9b59b6;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <h1>üåÜ –ë–ª–æ—á–Ω—ã–π –ú–µ–≥–∞–ø–æ–ª–∏—Å</h1>
        
        <div id="stats">
            <div class="stat"><span class="stat-icon">üí∞</span> –î–µ–Ω—å–≥–∏: $<span id="money">3</span></div>
            <div class="stat"><span class="stat-icon">üìà</span> –î–æ—Ö–æ–¥/—Å–µ–∫: $<span id="income">0</span></div>
            <div class="stat"><span class="stat-icon">üè¶</span> –í –±–∞–Ω–∫–µ: $<span id="bank-money">0</span></div>
        </div>
        
        <div id="money-bar">
            <div id="money-fill"></div>
            <div id="money-limit">–õ–∏–º–∏—Ç: $5000</div>
        </div>
        
        <div id="shop">
            <div class="shop-item" data-type="basic-block" data-cost="1">–ë–∞–∑–æ–≤—ã–π –±–ª–æ–∫ ($1)</div>
            <div class="shop-item" data-type="metal-block" data-cost="5">–ú–µ—Ç–∞–ª. –±–ª–æ–∫ ($5)</div>
            <div class="shop-item" data-type="pump" data-cost="16">–ù–∞—Å–æ—Å ($16)</div>
            <div class="shop-item" data-type="mover" data-cost="40">–ú—É–≤ ($40)</div>
            <div class="shop-item" data-type="water-pump" data-cost="60">–í–æ–¥–æ–Ω–æ—Å–æ—Å ($60)</div>
            <div class="shop-item" data-type="mech-pump" data-cost="100">–ú–µ—Ö. –Ω–∞—Å–æ—Å ($100)</div>
            <div class="shop-item" data-type="trigger" data-cost="225">–¢—Ä–∏–≥–≥–µ—Ä ($225)</div>
            <div class="shop-item" data-type="construction-block" data-cost="10">–°—Ç—Ä–æ–π–±–ª–æ–∫ ($10)</div>
            <div class="shop-item" data-type="bank" data-cost="300">–ë–∞–Ω–∫ ($300)</div>
            <div class="shop-item" data-type="house" data-cost="1250">–î–æ–º ($1250)</div>
            <div class="shop-item" data-type="new-board" data-cost="1000">–ù–æ–≤–∞—è –ø–ª–æ—â–∞–¥–∫–∞ ($1000)</div>
            <div class="shop-item" id="delete-btn">üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ</div>
        </div>
        
        <div id="boards-container">
            <div class="board-container">
                <div class="board-title">–ü–ª–æ—â–∞–¥–∫–∞ 1</div>
                <div class="board" id="board-1"></div>
            </div>
        </div>
    </div>

    <script>
        // –ò–≥—Ä–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let money = 3;
        let income = 0;
        let bankMoney = 0;
        const MONEY_LIMIT = 5000;
        let selectedItem = null;
        let deleteMode = false;
        let boards = [
            { id: 1, element: null, blocks: [], width: 300, height: 200, dirty: false, dirtyTimer: null }
        ];
        let nextBoardId = 2;
        let waterPumpClicks = {};
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function initGame() {
            // –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã DOM
            const moneyElement = document.getElementById('money');
            const incomeElement = document.getElementById('income');
            const bankMoneyElement = document.getElementById('bank-money');
            const shopItems = document.querySelectorAll('.shop-item');
            const deleteBtn = document.getElementById('delete-btn');
            const boardsContainer = document.getElementById('boards-container');
            const moneyFill = document.getElementById('money-fill');
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–µ—Ä–≤—É—é –ø–ª–æ—â–∞–¥–∫—É
            boards[0].element = document.getElementById('board-1');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–µ–Ω–µ–≥ –∏ –¥–æ—Ö–æ–¥–∞
            function updateStats() {
                moneyElement.textContent = money.toFixed(2);
                incomeElement.textContent = income.toFixed(2);
                bankMoneyElement.textContent = bankMoney.toFixed(2);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –¥–µ–Ω–µ–≥
                const moneyPercent = (money / MONEY_LIMIT) * 100;
                moneyFill.style.width = `${Math.min(moneyPercent, 100)}%`;
                
                if (moneyPercent > 80) {
                    moneyFill.style.backgroundColor = '#e74c3c';
                } else if (moneyPercent > 50) {
                    moneyFill.style.backgroundColor = '#f39c12';
                } else {
                    moneyFill.style.backgroundColor = '#2ecc71';
                }
            }
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –º–∞–≥–∞–∑–∏–Ω–∞
            shopItems.forEach(item => {
                if (item.id !== 'delete-btn') {
                    item.addEventListener('click', () => {
                        const type = item.dataset.type;
                        const cost = parseFloat(item.dataset.cost);
                        
                        if (money >= cost) {
                            // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å–æ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
                            shopItems.forEach(i => i.classList.remove('selected'));
                            // –í—ã–¥–µ–ª—è–µ–º —Ç–µ–∫—É—â–∏–π —ç–ª–µ–º–µ–Ω—Ç
                            item.classList.add('selected');
                            
                            selectedItem = type;
                            deleteMode = false;
                            deleteBtn.classList.remove('delete-mode');
                        } else {
                            alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥!');
                        }
                    });
                }
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ —É–¥–∞–ª–µ–Ω–∏—è
            deleteBtn.addEventListener('click', () => {
                deleteMode = !deleteMode;
                if (deleteMode) {
                    // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å–æ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –º–∞–≥–∞–∑–∏–Ω–∞
                    shopItems.forEach(i => i.classList.remove('selected'));
                    deleteBtn.classList.add('delete-mode');
                    selectedItem = null;
                } else {
                    deleteBtn.classList.remove('delete-mode');
                }
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–ª–æ—â–∞–¥–æ–∫
            boards.forEach(board => {
                board.element.addEventListener('click', (e) => {
                    const rect = board.element.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    
                    if (deleteMode) {
                        // –£–¥–∞–ª–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞
                        deleteBlock(board, x, y);
                    } else if (selectedItem) {
                        // –†–∞–∑–º–µ—â–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞
                        placeBlock(board, selectedItem, x, y);
                    }
                });
            });
            
            // –§—É–Ω–∫—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è –±–ª–æ–∫–∞
            function deleteBlock(board, x, y) {
                for (let i = board.blocks.length - 1; i >= 0; i--) {
                    const block = board.blocks[i];
                    const blockRect = block.element.getBoundingClientRect();
                    const blockX = blockRect.left - board.element.getBoundingClientRect().left;
                    const blockY = blockRect.top - board.element.getBoundingClientRect().top;
                    const blockWidth = blockRect.width;
                    const blockHeight = blockRect.height;
                    
                    if (x >= blockX && x <= blockX + blockWidth &&
                        y >= blockY && y <= blockY + blockHeight) {
                        // –£–¥–∞–ª—è–µ–º –±–ª–æ–∫
                        board.element.removeChild(block.element);
                        clearInterval(block.interval);
                        board.blocks.splice(i, 1);
                        
                        // –ï—Å–ª–∏ —ç—Ç–æ –±—ã–ª –≤–æ–¥–æ–Ω–æ—Å–æ—Å, —É–¥–∞–ª—è–µ–º –µ–≥–æ –∏–∑ —Å–ø–∏—Å–∫–∞ –∫–ª–∏–∫–æ–≤
                        if (block.type === 'water-pump') {
                            delete waterPumpClicks[block.id];
                        }
                        
                        updateIncome();
                        return;
                    }
                }
            }
            
            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –±–ª–æ–∫–∞
            function placeBlock(board, type, x, y) {
                const cost = getCostForType(type);
                if (money < cost) {
                    alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥!');
                    return;
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –º–æ–∂–Ω–æ –ª–∏ —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å –∑–¥–µ—Å—å –±–ª–æ–∫
                if (!canPlaceBlock(board, type, x, y)) {
                    alert('–ó–¥–µ—Å—å –Ω–µ–ª—å–∑—è —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å —ç—Ç–æ—Ç –±–ª–æ–∫!');
                    return;
                }
                
                money -= cost;
                updateStats();
                
                const blockElement = document.createElement('div');
                blockElement.className = 'block';
                
                let size = getSizeForType(type);
                let blockData = { 
                    id: Date.now() + Math.random().toString(36).substr(2, 9),
                    type: type, 
                    element: blockElement, 
                    x: x, 
                    y: y, 
                    size: size,
                    income: 0,
                    interval: null,
                    direction: type === 'trigger' ? Math.random() * Math.PI * 2 : 0
                };
                
                // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
                configureBlock(blockElement, blockData, board);
                
                board.element.appendChild(blockElement);
                board.blocks.push(blockData);
                
                // –î–ª—è –≤–æ–¥–æ–Ω–æ—Å–æ—Å–∞ –¥–æ–±–∞–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –∫–ª–∏–∫–æ–≤
                if (type === 'water-pump') {
                    waterPumpClicks[blockData.id] = 0;
                    updateWaterPumpDisplay(blockData);
                    
                    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–æ–≤ –Ω–∞ –≤–æ–¥–æ–Ω–æ—Å–æ—Å
                    blockElement.addEventListener('click', (e) => {
                        e.stopPropagation();
                        if (waterPumpClicks[blockData.id] < 5) {
                            waterPumpClicks[blockData.id]++;
                            updateWaterPumpDisplay(blockData);
                        }
                    });
                }
                
                // –î–ª—è –±–∞–Ω–∫–∞ –¥–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–æ–≤
                if (type === 'bank') {
                    blockElement.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const amount = parseFloat(prompt(`–°–∫–æ–ª—å–∫–æ –¥–µ–Ω–µ–≥ –ø–æ–ª–æ–∂–∏—Ç—å –≤ –±–∞–Ω–∫? (–î–æ—Å—Ç—É–ø–Ω–æ: $${money.toFixed(2)})`, Math.min(money, 100).toFixed(2)));
                        if (!isNaN(amount) && amount > 0 && amount <= money) {
                            money -= amount;
                            bankMoney += amount;
                            updateStats();
                        }
                    });
                }
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä –∑–∞–≥—Ä—è–∑–Ω–µ–Ω–∏—è –¥–ª—è –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤ (–∫—Ä–æ–º–µ –≤–æ–¥–æ–Ω–æ—Å–æ—Å–∞)
                if (type !== 'water-pump' && type !== 'construction-block' && type !== 'basic-block' && type !== 'metal-block') {
                    if (board.dirtyTimer) {
                        clearTimeout(board.dirtyTimer);
                    }
                    board.dirtyTimer = setTimeout(() => {
                        board.dirty = true;
                        board.element.classList.add('dirty');
                        updateIncome();
                    }, 60000); // 1 –º–∏–Ω—É—Ç–∞
                }
                
                updateIncome();
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞, –º–æ–∂–Ω–æ –ª–∏ —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å –±–ª–æ–∫ –≤ —ç—Ç–æ–º –º–µ—Å—Ç–µ
            function canPlaceBlock(board, type, x, y) {
                const size = getSizeForType(type);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥—Ä–∞–Ω–∏—Ü—ã –ø–ª–æ—â–∞–¥–∫–∏
                if (x - size/2 < 0 || x + size/2 > board.width || 
                    y - size/2 < 0 || y + size/2 > board.height) {
                    return false;
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ —Å –¥—Ä—É–≥–∏–º–∏ –±–ª–æ–∫–∞–º–∏
                for (const block of board.blocks) {
                    const blockSize = block.size;
                    const distance = Math.sqrt(
                        Math.pow(block.x - x, 2) + 
                        Math.pow(block.y - y, 2)
                    );
                    
                    if (distance < (size/2 + blockSize/2)) {
                        return false;
                    }
                }
                
                return true;
            }
            
            // –ü–æ–ª—É—á–∏—Ç—å —Ä–∞–∑–º–µ—Ä –±–ª–æ–∫–∞ –ø–æ —Ç–∏–ø—É
            function getSizeForType(type) {
                switch (type) {
                    case 'basic-block':
                    case 'metal-block':
                    case 'pump':
                    case 'mover':
                    case 'water-pump':
                    case 'trigger':
                        return 20;
                    case 'construction-block':
                        return 15;
                    case 'mech-pump':
                        return 40;
                    case 'bank':
                        return 50;
                    case 'house':
                        return 60;
                    default:
                        return 20;
                }
            }
            
            // –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ —Ç–∏–ø—É
            function getCostForType(type) {
                switch (type) {
                    case 'basic-block': return 1;
                    case 'metal-block': return 5;
                    case 'pump': return 16;
                    case 'mover': return 40;
                    case 'water-pump': return 60;
                    case 'mech-pump': return 100;
                    case 'trigger': return 225;
                    case 'construction-block': return 10;
                    case 'bank': return 300;
                    case 'house': return 1250;
                    case 'new-board': return 1000;
                    default: return 0;
                }
            }
            
            // –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –±–ª–æ–∫ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
            function configureBlock(element, blockData, board) {
                const { type, x, y, size } = blockData;
                
                element.classList.add(getClassForType(type));
                element.style.width = `${size}px`;
                element.style.height = `${size}px`;
                element.style.left = `${x - size/2}px`;
                element.style.top = `${y - size/2}px`;
                
                switch (type) {
                    case 'basic-block':
                        // –ë–∞–∑–æ–≤—ã–π –±–ª–æ–∫ - 20% —à–∞–Ω—Å –Ω–∞ $1 –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
                        blockData.interval = setInterval(() => {
                            if (Math.random() < 0.2) {
                                addMoney(1);
                            }
                        }, 1000);
                        break;
                        
                    case 'metal-block':
                        // –ú–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–∏–π –±–ª–æ–∫ - $1 –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
                        blockData.income = 1;
                        blockData.interval = setInterval(() => {
                            addMoney(blockData.income);
                        }, 5000);
                        break;
                        
                    case 'pump':
                        // –ù–∞—Å–æ—Å - $1 –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
                        blockData.income = 1;
                        blockData.interval = setInterval(() => {
                            addMoney(blockData.income);
                        }, 2000);
                        break;
                        
                    case 'mover':
                        // –ú—É–≤ - —É–¥–≤–∞–∏–≤–∞–µ—Ç –¥–æ—Ö–æ–¥ –±–ª–æ–∫–æ–≤ –≤ —Ä–∞–¥–∏—É—Å–µ
                        blockData.interval = setInterval(() => {
                            const blocksInRadius = getBlocksInRadius(board, x, y, 5);
                            blocksInRadius.forEach(block => {
                                if (block.type === 'basic-block' || block.type === 'metal-block') {
                                    block.income *= 2;
                                }
                            });
                            updateIncome();
                        }, 1000);
                        break;
                        
                    case 'water-pump':
                        // –í–æ–¥–æ–Ω–æ—Å–æ—Å - –æ—á–∏—â–∞–µ—Ç –∑–æ–Ω—É –ø—Ä–∏ –∫–ª–∏–∫–∞—Ö
                        blockData.interval = setInterval(() => {
                            if (waterPumpClicks[blockData.id] > 0) {
                                cleanArea(board, x, y, 20);
                                waterPumpClicks[blockData.id]--;
                                updateWaterPumpDisplay(blockData);
                            }
                        }, 1000);
                        break;
                        
                    case 'mech-pump':
                        // –ú–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∏–π –Ω–∞—Å–æ—Å - $5 –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
                        blockData.income = 5;
                        blockData.interval = setInterval(() => {
                            addMoney(blockData.income);
                        }, 1000);
                        break;
                        
                    case 'trigger':
                        // –¢—Ä–∏–≥–≥–µ—Ä - –¥–≤–∏–≥–∞–µ—Ç –±–ª–æ–∫–∏
                        blockData.interval = setInterval(() => {
                            moveConstructionBlocks(board, blockData);
                        }, 100);
                        break;
                        
                    case 'house':
                        // –î–æ–º - $1-20 –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
                        blockData.interval = setInterval(() => {
                            const randomIncome = 1 + Math.floor(Math.random() * 20);
                            addMoney(randomIncome);
                        }, 1000);
                        break;
                }
            }
            
            // –û—á–∏—Å—Ç–∏—Ç—å –∑–æ–Ω—É –≤–æ–∫—Ä—É–≥ –≤–æ–¥–æ–Ω–æ—Å–æ—Å–∞
            function cleanArea(board, x, y, radius) {
                let cleaned = false;
                
                // –û—á–∏—â–∞–µ–º –ø–ª–æ—â–∞–¥–∫—É
                if (board.dirty) {
                    board.dirty = false;
                    board.element.classList.remove('dirty');
                    if (board.dirtyTimer) {
                        clearTimeout(board.dirtyTimer);
                        board.dirtyTimer = null;
                    }
                    cleaned = true;
                }
                
                // –û—á–∏—â–∞–µ–º –±–ª–æ–∫–∏ –≤ —Ä–∞–¥–∏—É—Å–µ
                const blocksInRadius = getBlocksInRadius(board, x, y, radius);
                blocksInRadius.forEach(block => {
                    if (block.dirty) {
                        block.dirty = false;
                        if (block.element.querySelector('.dirty-overlay')) {
                            block.element.removeChild(block.element.querySelector('.dirty-overlay'));
                        }
                        cleaned = true;
                    }
                });
                
                if (cleaned) {
                    updateIncome();
                }
            }
            
            // –î–≤–∏–≥–∞—Ç—å —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–µ –±–ª–æ–∫–∏ —Å —Ç—Ä–∏–≥–≥–µ—Ä–∞
            function moveConstructionBlocks(board, trigger) {
                const blocksInRadius = getBlocksInRadius(board, trigger.x, trigger.y, trigger.size/2);
                
                blocksInRadius.forEach(block => {
                    if (block.type === 'construction-block') {
                        // –î–≤–∏–≥–∞–µ–º –±–ª–æ–∫ –≤ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ —Ç—Ä–∏–≥–≥–µ—Ä–∞
                        const speed = 1;
                        block.x += Math.cos(trigger.direction) * speed;
                        block.y += Math.sin(trigger.direction) * speed;
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –Ω–∞ —ç–∫—Ä–∞–Ω–µ
                        block.element.style.left = `${block.x - block.size/2}px`;
                        block.element.style.top = `${block.y - block.size/2}px`;
                        
                        // –ï—Å–ª–∏ –±–ª–æ–∫ –≤—ã—Ö–æ–¥–∏—Ç –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã, –º–µ–Ω—è–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
                        if (block.x < block.size/2 || block.x > board.width - block.size/2 ||
                            block.y < block.size/2 || block.y > board.height - block.size/2) {
                            trigger.direction = Math.random() * Math.PI * 2;
                        }
                    }
                });
            }
            
            // –ü–æ–ª—É—á–∏—Ç—å –∫–ª–∞—Å—Å CSS –¥–ª—è —Ç–∏–ø–∞ –±–ª–æ–∫–∞
            function getClassForType(type) {
                switch (type) {
                    case 'basic-block': return 'basic-block';
                    case 'metal-block': return 'metal-block';
                    case 'pump': return 'pump';
                    case 'mover': return 'mover';
                    case 'water-pump': return 'water-pump';
                    case 'mech-pump': return 'mech-pump';
                    case 'trigger': return 'trigger';
                    case 'construction-block': return 'construction-block';
                    case 'bank': return 'bank';
                    case 'house': return 'house';
                    default: return '';
                }
            }
            
            // –ü–æ–ª—É—á–∏—Ç—å –±–ª–æ–∫–∏ –≤ —Ä–∞–¥–∏—É—Å–µ
            function getBlocksInRadius(board, x, y, radius) {
                return board.blocks.filter(block => {
                    const distance = Math.sqrt(
                        Math.pow(block.x - x, 2) + 
                        Math.pow(block.y - y, 2)
                    );
                    return distance <= radius + block.size/2;
                });
            }
            
            // –û–±–Ω–æ–≤–∏—Ç—å –æ–±—â–∏–π –¥–æ—Ö–æ–¥
            function updateIncome() {
                income = 0;
                
                boards.forEach(board => {
                    const dirtyMultiplier = board.dirty ? 0.5 : 1;
                    
                    board.blocks.forEach(block => {
                        if (block.dirty) {
                            return; // –ì—Ä—è–∑–Ω—ã–µ –±–ª–æ–∫–∏ –Ω–µ –ø—Ä–∏–Ω–æ—Å—è—Ç –¥–æ—Ö–æ–¥–∞
                        }
                        
                        switch (block.type) {
                            case 'basic-block':
                                income += 0.2 * dirtyMultiplier; // 20% chance per second for $1
                                break;
                            case 'metal-block':
                                income += (block.income / 5) * dirtyMultiplier;
                                break;
                            case 'pump':
                                income += (block.income / 2) * dirtyMultiplier;
                                break;
                            case 'mech-pump':
                                income += block.income * dirtyMultiplier;
                                break;
                            case 'house':
                                income += 10.5 * dirtyMultiplier; // –°—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ 1-20
                                break;
                        }
                    });
                });
                
                updateStats();
            }
            
            // –î–æ–±–∞–≤–∏—Ç—å –¥–µ–Ω—å–≥–∏ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ª–∏–º–∏—Ç–∞
            function addMoney(amount) {
                money = Math.min(money + amount, MONEY_LIMIT);
                updateStats();
            }
            
            // –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–ª–∏–∫–æ–≤ –≤–æ–¥–æ–Ω–æ—Å–æ—Å–∞
            function updateWaterPumpDisplay(blockData) {
                const clicksDisplay = blockData.element.querySelector('.water-pump-clicks') || document.createElement('div');
                clicksDisplay.className = 'water-pump-clicks';
                clicksDisplay.textContent = `‚ö°${waterPumpClicks[blockData.id]}/5`;
                
                if (!blockData.element.querySelector('.water-pump-clicks')) {
                    blockData.element.appendChild(clicksDisplay);
                }
            }
            
            // –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –ø–ª–æ—â–∞–¥–∫—É
            function createNewBoard() {
                if (money >= 1000) {
                    money -= 1000;
                    updateStats();
                    
                    const boardId = nextBoardId++;
                    const boardContainer = document.createElement('div');
                    boardContainer.className = 'board-container';
                    
                    const boardTitle = document.createElement('div');
                    boardTitle.className = 'board-title';
                    boardTitle.textContent = `–ü–ª–æ—â–∞–¥–∫–∞ ${boardId}`;
                    
                    const boardElement = document.createElement('div');
                    boardElement.className = 'board';
                    boardElement.id = `board-${boardId}`;
                    
                    boardContainer.appendChild(boardTitle);
                    boardContainer.appendChild(boardElement);
                    document.getElementById('boards-container').appendChild(boardContainer);
                    
                    const newBoard = {
                        id: boardId,
                        element: boardElement,
                        blocks: [],
                        width: 300,
                        height: 200,
                        dirty: false,
                        dirtyTimer: null
                    };
                    
                    boards.push(newBoard);
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–æ–≤ –¥–ª—è –Ω–æ–≤–æ–π –ø–ª–æ—â–∞–¥–∫–∏
                    boardElement.addEventListener('click', (e) => {
                        const rect = boardElement.getBoundingClientRect();
                        const x = e.clientX - rect.left;
                        const y = e.clientY - rect.top;
                        
                        if (deleteMode) {
                            deleteBlock(newBoard, x, y);
                        } else if (selectedItem) {
                            placeBlock(newBoard, selectedItem, x, y);
                        }
                    });
                } else {
                    alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥ –¥–ª—è –Ω–æ–≤–æ–π –ø–ª–æ—â–∞–¥–∫–∏!');
                }
            }
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π –ø–ª–æ—â–∞–¥–∫–∏
            document.querySelector('.shop-item[data-type="new-board"]').addEventListener('click', createNewBoard);
            
            // –ò–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
            setInterval(() => {
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ –≤ –±–∞–Ω–∫–µ (1% –≤ —Å–µ–∫—É–Ω–¥—É)
                if (bankMoney > 0) {
                    const interest = bankMoney * 0.01;
                    bankMoney += interest;
                    updateStats();
                }
            }, 1000);
        }
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = initGame;
    </script>
</body>
</html>
