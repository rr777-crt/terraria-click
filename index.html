<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í—ã—Ä–∞—Å—Ç–∏ –°–∞–¥</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            text-align: center;
            background-color: #e0f7e0;
            margin: 0;
            padding: 20px;
        }
        #game-container {
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        #garden {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin: 20px 0;
        }
        .plot {
            width: 100px;
            height: 100px;
            background-color: #8d6e63;
            border: 2px solid #5d4037;
            border-radius: 5px;
            position: relative;
            cursor: pointer;
        }
        .plant {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            transition: all 0.3s;
        }
        #inventory {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .item {
            padding: 10px;
            background-color: #a5d6a7;
            border-radius: 5px;
            cursor: pointer;
            min-width: 80px;
            position: relative;
        }
        .item.selected {
            background-color: #4caf50;
            color: white;
        }
        .item-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background-color: #ff5722;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .common { background-color: #a5d6a7; }
        .rare { background-color: #90caf9; }
        .epic { background-color: #ce93d8; }
        .legendary { background-color: #ffb74d; }
        .mythical { background-color: #ef9a9a; }
        #stats {
            margin-bottom: 20px;
            font-size: 18px;
        }
        button {
            padding: 10px 15px;
            background-color: #4caf50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #388e3c;
        }
        .progress-bar {
            width: 100%;
            height: 10px;
            background-color: #e0e0e0;
            border-radius: 5px;
            margin-top: 5px;
            overflow: hidden;
        }
        .progress {
            height: 100%;
            background-color: #4caf50;
            width: 0%;
        }
        .message {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #4caf50;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            z-index: 1000;
            opacity: 1;
            transition: opacity 0.5s;
        }
        #timer {
            margin-top: 10px;
            font-size: 14px;
        }
        #shop-restock {
            margin-top: 10px;
            font-style: italic;
            color: #666;
        }
        #event-indicator {
            margin: 10px 0;
            padding: 8px;
            border-radius: 5px;
            font-weight: bold;
        }
        #inventory-panel {
            margin-top: 20px;
            padding: 10px;
            background-color: #f5f5f5;
            border-radius: 5px;
        }
        .inventory-item {
            display: inline-block;
            margin: 5px;
            padding: 5px 10px;
            background-color: #e8f5e9;
            border-radius: 3px;
        }
        .energy {
            background-color: gold;
            font-weight: bold;
        }
        .rain {
            background-color: #bbdefb;
        }
        .storm {
            background-color: #d1c4e9;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            max-width: 80%;
        }
        #save-buttons {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        .rarity-info {
            margin-top: 10px;
            font-size: 14px;
            color: #666;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <h1>–í—ã—Ä–∞—Å—Ç–∏ –°–∞–¥</h1>
        
        <div id="stats">
            <p>–î–µ–Ω—å–≥–∏: <span id="money">100</span> ‚ÇΩ</p>
            <p>–í–æ–¥–∞: <span id="water">50</span> / 100</p>
            <div class="progress-bar"><div id="water-bar" class="progress" style="width: 50%"></div></div>
            <p id="shop-restock">–ú–∞–≥–∞–∑–∏–Ω –æ–±–Ω–æ–≤–∏—Ç—Å—è —á–µ—Ä–µ–∑: <span id="restock-time">120</span> —Å–µ–∫</p>
            <div id="event-indicator"></div>
            <div class="rarity-info">
                –†–µ–¥–∫–æ—Å—Ç—å: 
                <span style="color: #2e7d32">–û–±—ã—á–Ω–∞—è</span> | 
                <span style="color: #1565c0">–†–µ–¥–∫–∞—è</span> | 
                <span style="color: #6a1b9a">–≠–ø–∏—á–µ—Å–∫–∞—è</span> | 
                <span style="color: #ef6c00">–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–∞—è</span> | 
                <span style="color: #c62828">–ú–∏—Ñ–∏—á–µ—Å–∫–∞—è</span>
            </div>
        </div>
        
        <div id="inventory">
            <!-- –¢–æ–≤–∞—Ä—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>
        
        <div id="garden"></div>
        
        <button id="refill-water">–ü–æ–ø–æ–ª–Ω–∏—Ç—å –≤–æ–¥—É (20‚ÇΩ)</button>
        <button id="show-inventory">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</button>
        
        <div id="inventory-panel" style="display: none;">
            <h3>–í–∞—à –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å</h3>
            <div id="inventory-items"></div>
            <button id="close-inventory">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
        
        <div id="save-buttons">
            <button id="save-game">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–≥—Ä—É</button>
            <button id="load-game">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–≥—Ä—É</button>
            <button id="delete-save">–£–¥–∞–ª–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ</button>
        </div>
    </div>

    <div id="sell-modal" class="modal">
        <div class="modal-content">
            <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–¥–∞–∂–∏</h3>
            <p id="sell-result"></p>
            <button id="close-modal">–û–ö</button>
        </div>
    </div>

    <script>
        // –ò–≥—Ä–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let money = 100;
        let water = 50;
        let selectedItem = null;
        let shopItems = {};
        let restockTimer = 120;
        let restockInterval;
        let eventTimer = 100;
        let eventInterval;
        let currentEvent = null;
        let playerInventory = {};
        let energyPlants = {};
        let plots = [];
        
        // –°–∏—Å—Ç–µ–º–∞ —Ä–µ–¥–∫–æ—Å—Ç–∏
        const RARITY = {
            COMMON: { name: "–û–±—ã—á–Ω–∞—è", min: 3, max: 5, class: "common" },
            RARE: { name: "–†–µ–¥–∫–∞—è", min: 2, max: 3, class: "rare" },
            EPIC: { name: "–≠–ø–∏—á–µ—Å–∫–∞—è", min: 1, max: 2, class: "epic" },
            LEGENDARY: { name: "–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–∞—è", min: 1, max: 1, class: "legendary" },
            MYTHICAL: { name: "–ú–∏—Ñ–∏—á–µ—Å–∫–∞—è", min: 1, max: 1, class: "mythical" }
        };
        
        // –î–∞–Ω–Ω—ã–µ –æ —Ä–∞—Å—Ç–µ–Ω–∏—è—Ö
        const plantsData = {
            carrot: {
                name: "–ú–æ—Ä–∫–æ–≤—å",
                price: 10,
                growTime: 19,
                profit: 15,
                rarity: RARITY.COMMON,
                emoji: "ü•ï"
            },
            tomato: {
                name: "–ü–æ–º–∏–¥–æ—Ä",
                price: 20,
                growTime: 30,
                profit: 30,
                rarity: RARITY.COMMON,
                emoji: "üçÖ"
            },
            flower: {
                name: "–¶–≤–µ—Ç–æ–∫",
                price: 15,
                growTime: 20,
                profit: 25,
                rarity: RARITY.COMMON,
                emoji: "üåª"
            },
            strawberry: {
                name: "–ö–ª—É–±–Ω–∏–∫–∞",
                price: 25,
                growTime: 10,
                profit: 15,
                rarity: RARITY.COMMON,
                isBush: true,
                maxHarvest: 2,
                emoji: "üçì"
            },
            bamboo: {
                name: "–ë–∞–º–±—É–∫",
                price: 250,
                growTime: 35,
                profit: 350,
                rarity: RARITY.RARE,
                emoji: "üéç"
            },
            pumpkin: {
                name: "–¢—ã–∫–≤–∞",
                price: 1000,
                growTime: 200,
                profit: 1250,
                rarity: RARITY.EPIC,
                emoji: "üéÉ"
            },
            coconut: {
                name: "–ö–æ–∫–æ—Å",
                price: 2000,
                growTime: 50,
                profit: 1100,
                rarity: RARITY.EPIC,
                bonus: 2,
                emoji: "ü••"
            },
            bigfruit: {
                name: "–ë–∏–≥—Ñ—Ä—É–∫—Ç",
                price: 10000,
                growTime: 1000,
                profit: 20000,
                rarity: RARITY.LEGENDARY,
                emoji: "üçà"
            },
            watermelon: {
                name: "–ê—Ä–±—É–∑",
                price: 750,
                growTime: 120,
                profit: 1000,
                rarity: RARITY.RARE,
                emoji: "üçâ"
            },
            pear: {
                name: "–ì—Ä—É—à–∞",
                price: 100,
                growTime: 5,
                profit: 125,
                rarity: RARITY.RARE,
                emoji: "üçê"
            },
            grapes: {
                name: "–í–∏–Ω–æ–≥—Ä–∞–¥",
                price: 15000,
                growTime: 600,
                profit: 30000,
                rarity: RARITY.MYTHICAL,
                emoji: "üçá"
            }
        };
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function initGame() {
            createGarden();
            initShop();
            startEventTimer();
            updateInventoryDisplay();
        }
        
        // –°–æ–∑–¥–∞–µ–º —Å–∞–¥ (5x5)
        function createGarden() {
            const garden = document.getElementById('garden');
            garden.innerHTML = '';
            plots = [];
            
            for (let i = 0; i < 25; i++) {
                const plot = document.createElement('div');
                plot.className = 'plot';
                plot.dataset.index = i;
                plot.addEventListener('click', handlePlotClick);
                garden.appendChild(plot);
                plots.push({
                    element: plot,
                    plant: null,
                    growth: 0,
                    water: 0,
                    growthStart: null,
                    timer: null,
                    harvestCount: 0,
                    hasEnergy: false
                });
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–∞–≥–∞–∑–∏–Ω–∞
        function initShop() {
            // –û—á–∏—â–∞–µ–º –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å
            document.getElementById('inventory').innerHTML = '';
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã (–ø–æ–ª–∏–≤ –∏ —Å–±–æ—Ä)
            addShopItem('water', '–ü–æ–ª–∏–≤ (5‚ÇΩ)', -1);
            addShopItem('harvest', '–°–±–æ—Ä', -1);
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω—ã–µ —Ä–∞—Å—Ç–µ–Ω–∏—è –¥–ª—è –º–∞–≥–∞–∑–∏–Ω–∞
            shopItems = {};
            const availablePlants = Object.keys(plantsData);
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Ä–∞—Å—Ç–µ–Ω–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–¥–∫–æ—Å—Ç–∏
            availablePlants.forEach(plant => {
                const rarity = plantsData[plant].rarity;
                const count = Math.floor(Math.random() * (rarity.max - rarity.min + 1)) + rarity.min;
                
                shopItems[plant] = count;
                addShopItem(plant, `${plantsData[plant].name} (${plantsData[plant].price}‚ÇΩ)`, count, rarity.class);
            });
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –º–∞–≥–∞–∑–∏–Ω–∞
            if (restockInterval) clearInterval(restockInterval);
            restockTimer = 120;
            updateRestockTimer();
            restockInterval = setInterval(() => {
                restockTimer--;
                updateRestockTimer();
                
                if (restockTimer <= 0) {
                    initShop();
                    showMessage('–ú–∞–≥–∞–∑–∏–Ω –æ–±–Ω–æ–≤–∏–ª—Å—è!');
                }
            }, 1000);
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞ –≤ –º–∞–≥–∞–∑–∏–Ω
        function addShopItem(type, name, count, rarityClass) {
            const inventory = document.getElementById('inventory');
            const item = document.createElement('div');
            item.className = `item ${rarityClass || ''}`;
            item.dataset.type = type;
            item.textContent = name;
            
            if (count > 0) {
                const countBadge = document.createElement('div');
                countBadge.className = 'item-count';
                countBadge.textContent = count;
                item.appendChild(countBadge);
            }
            
            item.addEventListener('click', function() {
                if (count === 0) return;
                
                document.querySelectorAll('.item').forEach(i => i.classList.remove('selected'));
                this.classList.add('selected');
                selectedItem = this.dataset.type;
                
                if (type !== 'water' && type !== 'harvest' && shopItems[type] > 0) {
                    if (shopItems[type] === 1) {
                        this.style.opacity = '0.5';
                        this.style.pointerEvents = 'none';
                    }
                }
            });
            
            inventory.appendChild(item);
        }
        
        // –ó–∞–ø—É—Å–∫ —Ç–∞–π–º–µ—Ä–∞ —Å–æ–±—ã—Ç–∏–π
        function startEventTimer() {
            if (eventInterval) clearInterval(eventInterval);
            eventTimer = 100;
            updateEventTimer();
            eventInterval = setInterval(() => {
                eventTimer--;
                updateEventTimer();
                
                if (eventTimer <= 0) {
                    triggerRandomEvent();
                    eventTimer = 100;
                }
            }, 1000);
        }
        
        // –¢—Ä–∏–≥–≥–µ—Ä —Å–ª—É—á–∞–π–Ω–æ–≥–æ —Å–æ–±—ã—Ç–∏—è
        function triggerRandomEvent() {
            const random = Math.random() * 100;
            
            // –ó–∞–≤–µ—Ä—à–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–µ–µ —Å–æ–±—ã—Ç–∏–µ
            if (currentEvent) {
                document.getElementById('event-indicator').textContent = '';
                document.getElementById('event-indicator').className = '';
                currentEvent = null;
            }
            
            if (random < 70) {
                // 70% - –æ–±—ã—á–Ω—ã–π –¥–µ–Ω—å
                showMessage('–°–µ–≥–æ–¥–Ω—è –æ–±—ã—á–Ω—ã–π –¥–µ–Ω—å');
            } else if (random < 95) {
                // 25% - –¥–æ–∂–¥—å
                currentEvent = 'rain';
                document.getElementById('event-indicator').textContent = '–ò–î–Å–¢ –î–û–ñ–î–¨: —Ä–∞—Å—Ç–µ–Ω–∏—è —Ä–∞—Å—Ç—É—Ç –≤ 2 —Ä–∞–∑–∞ –±—ã—Å—Ç—Ä–µ–µ!';
                document.getElementById('event-indicator').className = 'rain';
                showMessage('–ü–æ—à—ë–ª –¥–æ–∂–¥—å! –†–∞—Å—Ç–µ–Ω–∏—è —Ä–∞—Å—Ç—É—Ç –±—ã—Å—Ç—Ä–µ–µ!');
                
                // –£—Å–∫–æ—Ä—è–µ–º —Ä–æ—Å—Ç –≤—Å–µ—Ö —Ä–∞—Å—Ç–µ–Ω–∏–π
                plots.forEach(plot => {
                    if (plot.plant && plot.growthStart) {
                        plot.growthStart = new Date(plot.growthStart.getTime() - plantGrowTime(plot.plant) * 500);
                    }
                });
            } else {
                // 5% - –≥—Ä–æ–∑–∞
                currentEvent = 'storm';
                document.getElementById('event-indicator').textContent = '–ì–†–û–ó–ê: –æ–¥–Ω–æ —Ä–∞—Å—Ç–µ–Ω–∏–µ –ø–æ–ª—É—á–∏—Ç —ç–Ω–µ—Ä–≥–∏—é!';
                document.getElementById('event-indicator').className = 'storm';
                showMessage('–ù–∞—á–∞–ª–∞—Å—å –≥—Ä–æ–∑–∞! –û–¥–Ω–æ —Ä–∞—Å—Ç–µ–Ω–∏–µ –ø–æ–ª—É—á–∏—Ç —ç–Ω–µ—Ä–≥–∏—é!');
                
                // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ —Ä–∞—Å—Ç–µ–Ω–∏–µ –¥–ª—è —ç–Ω–µ—Ä–≥–∏–∏
                const plantsWithIndex = plots.map((plot, index) => ({plot, index})).filter(p => p.plot.plant);
                if (plantsWithIndex.length > 0) {
                    const randomPlant = plantsWithIndex[Math.floor(Math.random() * plantsWithIndex.length)];
                    randomPlant.plot.hasEnergy = true;
                    energyPlants[randomPlant.index] = true;
                    updatePlant(randomPlant.plot);
                    showMessage(`${plantName(randomPlant.plot.plant)} –ø–æ–ª—É—á–∏–ª(–∞) —ç–Ω–µ—Ä–≥–∏—é!`);
                }
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–π–º–µ—Ä–∞ —Å–æ–±—ã—Ç–∏–π
        function updateEventTimer() {
            // –ù–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º, —Ç–∞–∫ –∫–∞–∫ —Ç–∞–π–º–µ—Ä —Å–æ–±—ã—Ç–∏–π —Å–∫—Ä—ã—Ç
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–π–º–µ—Ä–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –º–∞–≥–∞–∑–∏–Ω–∞
        function updateRestockTimer() {
            document.getElementById('restock-time').textContent = restockTimer;
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –≥—Ä—è–¥–∫–µ
        function handlePlotClick(event) {
            const index = event.currentTarget.dataset.index;
            const plot = plots[index];
            
            if (selectedItem === 'water') {
                // –ü–æ–ª–∏–≤
                if (water >= 5 && plot.plant) {
                    water -= 5;
                    if (plot.growthStart) {
                        const timeReduction = currentEvent === 'rain' ? 10000 : 5000;
                        plot.growthStart = new Date(plot.growthStart.getTime() - timeReduction);
                        showMessage('–†–∞—Å—Ç–µ–Ω–∏–µ –ø–æ–ª–∏—Ç–æ! -5 —Å–µ–∫—É–Ω–¥ –∫ –≤—Ä–µ–º–µ–Ω–∏ —Ä–æ—Å—Ç–∞' + (currentEvent === 'rain' ? ' (–¥–æ–∂–¥—å —É–¥–≤–∞–∏–≤–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç!)' : ''));
                    }
                    updateStats();
                } else if (!plot.plant) {
                    showMessage('–ó–¥–µ—Å—å –Ω–µ—Ç —Ä–∞—Å—Ç–µ–Ω–∏—è –¥–ª—è –ø–æ–ª–∏–≤–∞!');
                } else {
                    showMessage('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–æ–¥—ã!');
                }
            } else if (selectedItem === 'harvest') {
                // –°–±–æ—Ä —É—Ä–æ–∂–∞—è
                if (plot.plant) {
                    if (isBush(plot.plant)) {
                        if (isGrown(plot)) {
                            if (plot.harvestCount < plantProperties(plot.plant).maxHarvest) {
                                plot.harvestCount++;
                                const profit = plot.hasEnergy ? plantProfit(plot.plant) * 3 : plantProfit(plot.plant);
                                addToInventory(plot.plant, profit, plot.hasEnergy);
                                updateStats();
                                showMessage(`–°–æ–±—Ä–∞–Ω–∞ ${plantName(plot.plant)}! +${profit}‚ÇΩ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å` + (plot.hasEnergy ? ' (—ç–Ω–µ—Ä–≥–∏—è x3!)' : ''));
                                
                                // –£–±–∏—Ä–∞–µ–º —ç–Ω–µ—Ä–≥–∏—é –ø–æ—Å–ª–µ —Å–±–æ—Ä–∞
                                if (plot.hasEnergy) {
                                    plot.hasEnergy = false;
                                    delete energyPlants[index];
                                }
                                
                                // –£–±–∏—Ä–∞–µ–º —Ä–∞—Å—Ç–µ–Ω–∏–µ –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–±–æ—Ä–∞
                                if (plot.harvestCount >= plantProperties[plot.plant].maxHarvest) {
                                    setTimeout(() => resetPlot(plot), 1000);
                                }
                            } else {
                                showMessage('–≠—Ç–æ—Ç –∫—É—Å—Ç –±–æ–ª—å—à–µ –Ω–µ –¥–∞—Å—Ç —É—Ä–æ–∂–∞—è!');
                            }
                        } else {
                            showMessage('–†–∞—Å—Ç–µ–Ω–∏–µ –µ—â–µ –Ω–µ —Å–æ–∑—Ä–µ–ª–æ!');
                        }
                    } else if (isGrown(plot)) {
                        const profit = plot.hasEnergy ? plantProfit(plot.plant) * 3 : plantProfit(plot.plant);
                        addToInventory(plot.plant, profit, plot.hasEnergy);
                        resetPlot(plot);
                        updateStats();
                        showMessage(`–£—Ä–æ–∂–∞–π ${plantName(plot.plant)} —Å–æ–±—Ä–∞–Ω! +${profit}‚ÇΩ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å` + (plot.hasEnergy ? ' (—ç–Ω–µ—Ä–≥–∏—è x3!)' : ''));
                    } else {
                        showMessage('–†–∞—Å—Ç–µ–Ω–∏–µ –µ—â–µ –Ω–µ —Å–æ–∑—Ä–µ–ª–æ!');
                    }
                } else {
                    showMessage('–ó–¥–µ—Å—å –Ω–µ—á–µ–≥–æ —Å–æ–±–∏—Ä–∞—Ç—å!');
                }
            } else if (selectedItem && shopItems[selectedItem] !== undefined) {
                // –ü–æ–∫—É–ø–∫–∞ –∏ –ø–æ—Å–∞–¥–∫–∞ —Ä–∞—Å—Ç–µ–Ω–∏—è
                if (!plot.plant && money >= plantPrice(selectedItem)) {
                    if (shopItems[selectedItem] > 0) {
                        money -= plantPrice(selectedItem);
                        shopItems[selectedItem]--;
                        updateShopItems();
                        
                        plot.plant = selectedItem;
                        plot.growth = 0;
                        plot.water = 0;
                        plot.harvestCount = 0;
                        plot.growthStart = new Date();
                        plot.hasEnergy = false;
                        startGrowthTimer(plot);
                        updatePlant(plot);
                        updateStats();
                        showMessage(`${plantName(selectedItem)} –ø–æ—Å–∞–∂–µ–Ω–∞!`);
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–æ–Ω—É—Å –¥–ª—è –∫–æ–∫–æ—Å–∞
                        if (selectedItem === 'coconut' && plantProperties(selectedItem).bonus) {
                            setTimeout(() => {
                                const bonusCount = plantProperties(selectedItem).bonus;
                                addToInventory(selectedItem, plantProfit(selectedItem) * bonusCount, false);
                                updateStats();
                                showMessage(`–í—ã –ø–æ–ª—É—á–∏–ª–∏ ${bonusCount} –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∫–æ–∫–æ—Å–∞ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å!`);
                            }, 1000);
                        }
                    } else {
                        showMessage('–≠—Ç–æ —Ä–∞—Å—Ç–µ–Ω–∏–µ –∑–∞–∫–æ–Ω—á–∏–ª–æ—Å—å –≤ –º–∞–≥–∞–∑–∏–Ω–µ!');
                    }
                } else if (plot.plant) {
                    showMessage('–ó–¥–µ—Å—å —É–∂–µ —á—Ç–æ-—Ç–æ —Ä–∞—Å—Ç–µ—Ç!');
                } else {
                    showMessage('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥!');
                }
            }
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å
        function addToInventory(plantType, profit, hasEnergy) {
            if (!playerInventory[plantType]) {
                playerInventory[plantType] = {
                    count: 0,
                    totalProfit: 0,
                    withEnergy: 0
                };
            }
            
            playerInventory[plantType].count++;
            playerInventory[plantType].totalProfit += profit;
            if (hasEnergy) {
                playerInventory[plantType].withEnergy++;
            }
            
            updateInventoryDisplay();
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
        function updateInventoryDisplay() {
            const inventoryItems = document.getElementById('inventory-items');
            inventoryItems.innerHTML = '';
            
            for (const plantType in playerInventory) {
                const item = document.createElement('div');
                item.className = 'inventory-item';
                if (playerInventory[plantType].withEnergy > 0) {
                    item.classList.add('energy');
                }
                
                item.textContent = `${plantsData[plantType].emoji} ${plantName(plantType)}: ${playerInventory[plantType].count} (${playerInventory[plantType].totalProfit}‚ÇΩ)`;
                if (playerInventory[plantType].withEnergy > 0) {
                    item.textContent += ` (${playerInventory[plantType].withEnergy} —Å —ç–Ω–µ—Ä–≥–∏–µ–π)`;
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –ø—Ä–æ–¥–∞–∂–∏
                const sellBtn = document.createElement('button');
                sellBtn.textContent = '–ü—Ä–æ–¥–∞—Ç—å';
                sellBtn.style.marginLeft = '5px';
                sellBtn.style.fontSize = '12px';
                sellBtn.addEventListener('click', () => sellInventoryItem(plantType));
                item.appendChild(sellBtn);
                
                inventoryItems.appendChild(item);
            }
        }
        
        // –ü—Ä–æ–¥–∞–∂–∞ –ø—Ä–µ–¥–º–µ—Ç–∞ –∏–∑ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
        function sellInventoryItem(plantType) {
            if (playerInventory[plantType]) {
                const profit = playerInventory[plantType].totalProfit;
                money += profit;
                delete playerInventory[plantType];
                updateStats();
                updateInventoryDisplay();
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–¥–∞–∂–∏
                document.getElementById('sell-result').textContent = `–í—ã –ø—Ä–æ–¥–∞–ª–∏ ${plantName(plantType)} –∑–∞ ${profit}‚ÇΩ`;
                document.getElementById('sell-modal').style.display = 'flex';
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –º–∞–≥–∞–∑–∏–Ω–µ
        function updateShopItems() {
            document.querySelectorAll('.item').forEach(item => {
                const type = item.dataset.type;
                if (shopItems[type] !== undefined) {
                    const countBadge = item.querySelector('.item-count');
                    if (countBadge) {
                        if (shopItems[type] > 0) {
                            countBadge.textContent = shopItems[type];
                            item.style.opacity = '1';
                            item.style.pointerEvents = 'auto';
                        } else {
                            item.style.opacity = '0.5';
                            item.style.pointerEvents = 'none';
                        }
                    }
                }
            });
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–≤–æ–π—Å—Ç–≤ —Ä–∞—Å—Ç–µ–Ω–∏—è
        function plantProperties(plantType) {
            return plantsData[plantType] || {};
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–º–µ–Ω–∏ —Ä–∞—Å—Ç–µ–Ω–∏—è
        function plantName(plantType) {
            return plantProperties(plantType).name || plantType;
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ü–µ–Ω—ã —Ä–∞—Å—Ç–µ–Ω–∏—è
        function plantPrice(plantType) {
            return plantProperties(plantType).price || 0;
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–∏–±—ã–ª–∏ –æ—Ç —Ä–∞—Å—Ç–µ–Ω–∏—è
        function plantProfit(plantType) {
            return plantProperties(plantType).profit || 0;
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ —Ä–æ—Å—Ç–∞ —Ä–∞—Å—Ç–µ–Ω–∏—è
        function plantGrowTime(plantType) {
            return plantProperties(plantType).growTime || 0;
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ä–∞—Å—Ç–µ–Ω–∏–µ –∫—É—Å—Ç–æ–º
        function isBush(plantType) {
            return plantProperties(plantType).isBush || false;
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ä–∞—Å—Ç–µ–Ω–∏–µ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–º
        function isPermanent(plantType) {
            return plantProperties(plantType).isPermanent === false ? false : true;
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞, –≤—ã—Ä–æ—Å–ª–æ –ª–∏ —Ä–∞—Å—Ç–µ–Ω–∏–µ
        function isGrown(plot) {
            if (!plot.growthStart) return false;
            const growTime = plantGrowTime(plot.plant) * 1000;
            const now = new Date();
            return now - plot.growthStart >= growTime;
        }
        
        // –ó–∞–ø—É—Å–∫ —Ç–∞–π–º–µ—Ä–∞ —Ä–æ—Å—Ç–∞
        function startGrowthTimer(plot) {
            if (plot.timer) clearInterval(plot.timer);
            
            plot.timer = setInterval(() => {
                const now = new Date();
                const elapsed = now - plot.growthStart;
                const growTime = plantGrowTime(plot.plant) * 1000;
                
                if (elapsed >= growTime) {
                    plot.growth = 1;
                    clearInterval(plot.timer);
                    plot.timer = null;
                } else {
                    plot.growth = elapsed / growTime;
                }
                
                updatePlant(plot);
            }, 100);
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–∞—Å—Ç–µ–Ω–∏—è
        function updatePlant(plot) {
            // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–µ–µ —Ä–∞—Å—Ç–µ–Ω–∏–µ
            plot.element.innerHTML = '';
            
            if (!plot.plant) return;
            
            const plantDiv = document.createElement('div');
            plantDiv.className = 'plant';
            
            const size = 20 + plot.growth * 50;
            
            let emoji = plantsData[plot.plant]?.emoji || 'üå±';
            if (plot.growth <= 0.5) emoji = 'üå±';
            else if (plot.growth <= 0.8) emoji = 'üåø';
            
            plantDiv.textContent = emoji;
            plantDiv.style.fontSize = `${size}px`;
            
            if (plot.hasEnergy) {
                plantDiv.style.textShadow = '0 0 10px gold';
            }
            
            // –ü—Ä–æ–≥—Ä–µ—Å—Å —Ä–æ—Å—Ç–∞
            const progressBar = document.createElement('div');
            progressBar.className = 'progress-bar';
            const progress = document.createElement('div');
            progress.className = 'progress';
            progress.style.width = `${plot.growth * 100}%`;
            progressBar.appendChild(progress);
            
            // –¢–∞–π–º–µ—Ä
            const timer = document.createElement('div');
            timer.id = 'timer';
            if (plot.growthStart && !isGrown(plot)) {
                const remaining = Math.ceil((plantGrowTime(plot.plant) * 1000 - (new Date() - plot.growthStart)) / 1000);
                timer.textContent = `${remaining} —Å–µ–∫`;
            } else if (isGrown(plot)) {
                timer.textContent = '–ì–æ—Ç–æ–≤–æ!';
                if (isBush(plot.plant)) {
                    timer.textContent += ` (–°–æ–±—Ä–∞–Ω–æ: ${plot.harvestCount}/${plantProperties(plot.plant).maxHarvest})`;
                }
                if (plot.hasEnergy) {
                    timer.textContent += ' ‚ö°';
                }
            }
            
            plot.element.appendChild(plantDiv);
            plot.element.appendChild(progressBar);
            plot.element.appendChild(timer);
        }
        
        // –°–±—Ä–æ—Å –≥—Ä—è–¥–∫–∏
        function resetPlot(plot) {
            if (plot.timer) clearInterval(plot.timer);
            plot.plant = null;
            plot.growth = 0;
            plot.water = 0;
            plot.growthStart = null;
            plot.timer = null;
            plot.harvestCount = 0;
            plot.hasEnergy = false;
            plot.element.innerHTML = '';
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStats() {
            document.getElementById('money').textContent = money;
            document.getElementById('water').textContent = water;
            document.getElementById('water-bar').style.width = `${water}%`;
        }
        
        // –°–∏—Å—Ç–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–≥—Ä—ã
        function saveGame() {
            const gameData = {
                money: money,
                water: water,
                shopItems: shopItems,
                restockTimer: restockTimer,
                playerInventory: playerInventory,
                plots: plots.map(plot => ({
                    plant: plot.plant,
                    growth: plot.growth,
                    growthStart: plot.growthStart ? plot.growthStart.getTime() : null,
                    harvestCount: plot.harvestCount,
                    hasEnergy: plot.hasEnergy
                })),
                energyPlants: energyPlants,
                currentEvent: currentEvent,
                eventTimer: eventTimer
            };
            localStorage.setItem('gardenGameSave', JSON.stringify(gameData));
            showMessage('–ò–≥—Ä–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!');
        }
        
        function loadGame() {
            const savedData = localStorage.getItem('gardenGameSave');
            if (!savedData) return false;
            
            try {
                const gameData = JSON.parse(savedData);
                
                money = gameData.money;
                water = gameData.water;
                shopItems = gameData.shopItems;
                restockTimer = gameData.restockTimer;
                playerInventory = gameData.playerInventory;
                energyPlants = gameData.energyPlants || {};
                currentEvent = gameData.currentEvent;
                eventTimer = gameData.eventTimer;
                
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≥—Ä—è–¥–∫–∏
                gameData.plots.forEach((savedPlot, index) => {
                    if (index >= plots.length) return;
                    
                    plots[index].plant = savedPlot.plant;
                    plots[index].growth = savedPlot.growth;
                    plots[index].growthStart = savedPlot.growthStart ? new Date(savedPlot.growthStart) : null;
                    plots[index].harvestCount = savedPlot.harvestCount;
                    plots[index].hasEnergy = savedPlot.hasEnergy;
                    
                    // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä —Ä–æ—Å—Ç–∞, –µ—Å–ª–∏ —Ä–∞—Å—Ç–µ–Ω–∏–µ –Ω–µ –≤—ã—Ä–æ—Å–ª–æ
                    if (plots[index].plant && plots[index].growthStart && 
                        !isGrown(plots[index])) {
                        startGrowthTimer(plots[index]);
                    }
                    
                    updatePlant(plots[index]);
                });
                
                updateStats();
                updateShopItems();
                updateInventoryDisplay();
                
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ–±—ã—Ç–∏–µ, –µ—Å–ª–∏ –æ–Ω–æ –∞–∫—Ç–∏–≤–Ω–æ
                if (currentEvent) {
                    document.getElementById('event-indicator').className = currentEvent;
                    if (currentEvent === 'rain') {
                        document.getElementById('event-indicator').textContent = 
                            '–ò–î–Å–¢ –î–û–ñ–î–¨: —Ä–∞—Å—Ç–µ–Ω–∏—è —Ä–∞—Å—Ç—É—Ç –≤ 2 —Ä–∞–∑–∞ –±—ã—Å—Ç—Ä–µ–µ!';
                    } else if (currentEvent === 'storm') {
                        document.getElementById('event-indicator').textContent = 
                            '–ì–†–û–ó–ê: –æ–¥–Ω–æ —Ä–∞—Å—Ç–µ–Ω–∏–µ –ø–æ–ª—É—á–∏—Ç —ç–Ω–µ—Ä–≥–∏—é!';
                    }
                }
                
                return true;
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', e);
                return false;
            }
        }
        
        function deleteSave() {
            localStorage.removeItem('gardenGameSave');
            showMessage('–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ!');
        }
        
        // –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –≤–æ–¥—ã
        document.getElementById('refill-water').addEventListener('click', function() {
            if (money >= 20) {
                money -= 20;
                water = 100;
                updateStats();
                showMessage('–í–æ–¥–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∞!');
            } else {
                showMessage('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥!');
            }
        });
        
        // –ü–æ–∫–∞–∑ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
        document.getElementById('show-inventory').addEventListener('click', function() {
            document.getElementById('inventory-panel').style.display = 'block';
        });
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
        document.getElementById('close-inventory').addEventListener('click', function() {
            document.getElementById('inventory-panel').style.display = 'none';
        });
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        document.getElementById('close-modal').addEventListener('click', function() {
            document.getElementById('sell-modal').style.display = 'none';
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
        document.getElementById('save-game').addEventListener('click', saveGame);
        document.getElementById('load-game').addEventListener('click', () => {
            if (loadGame()) {
                showMessage('–ò–≥—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞!');
            } else {
                showMessage('–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ!');
            }
        });
        document.getElementById('delete-save').addEventListener('click', deleteSave);
        
        // –í—Å–ø–ª—ã–≤–∞—é—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
        function showMessage(text) {
            const existingMsg = document.querySelector('.message');
            if (existingMsg) existingMsg.remove();
            
            const msg = document.createElement('div');
            msg.className = 'message';
            msg.textContent = text;
            document.body.appendChild(msg);
            
            setTimeout(() => {
                msg.style.opacity = '0';
                setTimeout(() => msg.remove(), 500);
            }, 2000);
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        window.addEventListener('load', () => {
            createGarden(); // –°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–µ–º –≥—Ä—è–¥–∫–∏
            if (loadGame()) {
                showMessage('–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ!');
            } else {
                initGame();
            }
        });
// 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –º–∞–≥–∞–∑–∏–Ω–∞
function saveGame() {
    const gameData = {
        money: money,
        water: water,
        shopItems: JSON.parse(JSON.stringify(shopItems)), // –ì–ª—É–±–æ–∫–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ shopItems
        restockTimer: restockTimer,
        playerInventory: playerInventory,
        plots: plots.map(plot => ({
            plant: plot.plant,
            growth: plot.growth,
            growthStart: plot.growthStart ? plot.growthStart.getTime() : null,
            harvestCount: plot.harvestCount,
            hasEnergy: plot.hasEnergy,
            water: plot.water // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è –ø–æ–ª–∏–≤–∞
        })),
        energyPlants: energyPlants,
        currentEvent: currentEvent,
        eventTimer: eventTimer,
        lastShopUpdate: Date.now() // –î–æ–±–∞–≤–ª—è–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –º–∞–≥–∞–∑–∏–Ω–∞
    };
    localStorage.setItem('gardenGameSave', JSON.stringify(gameData));
    showMessage('–ò–≥—Ä–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!');
}

function loadGame() {
    const savedData = localStorage.getItem('gardenGameSave');
    if (!savedData) return false;
    
    try {
        const gameData = JSON.parse(savedData);
        
        money = gameData.money;
        water = gameData.water;
        shopItems = gameData.shopItems;
        restockTimer = gameData.restockTimer;
        playerInventory = gameData.playerInventory;
        energyPlants = gameData.energyPlants || {};
        currentEvent = gameData.currentEvent;
        eventTimer = gameData.eventTimer;
        
        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Ä–µ–º—è –¥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –º–∞–≥–∞–∑–∏–Ω–∞
        if (gameData.lastShopUpdate) {
            const timePassed = Math.floor((Date.now() - gameData.lastShopUpdate) / 1000);
            restockTimer = Math.max(0, restockTimer - timePassed);
        }
        
        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≥—Ä—è–¥–∫–∏
        gameData.plots.forEach((savedPlot, index) => {
            if (index >= plots.length) return;
            
            plots[index].plant = savedPlot.plant;
            plots[index].growth = savedPlot.growth;
            plots[index].growthStart = savedPlot.growthStart ? new Date(savedPlot.growthStart) : null;
            plots[index].harvestCount = savedPlot.harvestCount;
            plots[index].hasEnergy = savedPlot.hasEnergy;
            plots[index].water = savedPlot.water || 0; // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —É—Ä–æ–≤–µ–Ω—å –ø–æ–ª–∏–≤–∞
            
            // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä —Ä–æ—Å—Ç–∞, –µ—Å–ª–∏ —Ä–∞—Å—Ç–µ–Ω–∏–µ –Ω–µ –≤—ã—Ä–æ—Å–ª–æ
            if (plots[index].plant && plots[index].growthStart && 
                !isGrown(plots[index])) {
                startGrowthTimer(plots[index]);
            }
            
            updatePlant(plots[index]);
        });
        
        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–∞–≥–∞–∑–∏–Ω
        updateShopItems();
        updateStats();
        updateInventoryDisplay();
        
        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ–±—ã—Ç–∏–µ, –µ—Å–ª–∏ –æ–Ω–æ –∞–∫—Ç–∏–≤–Ω–æ
        if (currentEvent) {
            document.getElementById('event-indicator').className = currentEvent;
            if (currentEvent === 'rain') {
                document.getElementById('event-indicator').textContent = 
                    '–ò–î–Å–¢ –î–û–ñ–î–¨: —Ä–∞—Å—Ç–µ–Ω–∏—è —Ä–∞—Å—Ç—É—Ç –≤ 2 —Ä–∞–∑–∞ –±—ã—Å—Ç—Ä–µ–µ!';
                // –£—Å–∫–æ—Ä—è–µ–º —Ä–æ—Å—Ç –≤—Å–µ—Ö —Ä–∞—Å—Ç–µ–Ω–∏–π
                plots.forEach(plot => {
                    if (plot.plant && plot.growthStart) {
                        plot.growthStart = new Date(plot.growthStart.getTime() - plantGrowTime(plot.plant) * 500);
                    }
                });
            } else if (currentEvent === 'storm') {
                document.getElementById('event-indicator').textContent = 
                    '–ì–†–û–ó–ê: –æ–¥–Ω–æ —Ä–∞—Å—Ç–µ–Ω–∏–µ –ø–æ–ª—É—á–∏—Ç —ç–Ω–µ—Ä–≥–∏—é!';
            }
        }
        
        return true;
    } catch (e) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', e);
        return false;
    }
}

// 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–∞ –æ—Ç –¥–æ–∂–¥—è (–≤ —Ñ—É–Ω–∫—Ü–∏–∏ handlePlotClick)
if (selectedItem === 'water') {
    // –ü–æ–ª–∏–≤
    if (water >= 5 && plot.plant) {
        water -= 5;
        plot.water += 1; // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –ø–æ–ª–∏–≤–∞
        if (plot.growthStart) {
            const timeReduction = currentEvent === 'rain' ? 10000 : 5000; // –î–æ–∂–¥—å –¥–∞–µ—Ç –¥–≤–æ–π–Ω–æ–π –±–æ–Ω—É—Å
            plot.growthStart = new Date(plot.growthStart.getTime() - timeReduction);
            showMessage('–†–∞—Å—Ç–µ–Ω–∏–µ –ø–æ–ª–∏—Ç–æ! -' + 
                (currentEvent === 'rain' ? '10' : '5') + 
                ' —Å–µ–∫—É–Ω–¥ –∫ –≤—Ä–µ–º–µ–Ω–∏ —Ä–æ—Å—Ç–∞' + 
                (currentEvent === 'rain' ? ' (–¥–æ–∂–¥—å —É–¥–≤–∞–∏–≤–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç!)' : ''));
        }
        updateStats();
    } else if (!plot.plant) {
        showMessage('–ó–¥–µ—Å—å –Ω–µ—Ç —Ä–∞—Å—Ç–µ–Ω–∏—è –¥–ª—è –ø–æ–ª–∏–≤–∞!');
    } else {
        showMessage('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–æ–¥—ã!');
    }
}

// 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ triggerRandomEvent –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —É—Å–∫–æ—Ä–µ–Ω–∏—è —Ä–æ—Å—Ç–∞
function triggerRandomEvent() {
    const random = Math.random() * 100;
    
    // –ó–∞–≤–µ—Ä—à–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–µ–µ —Å–æ–±—ã—Ç–∏–µ
    if (currentEvent) {
        document.getElementById('event-indicator').textContent = '';
        document.getElementById('event-indicator').className = '';
        
        // –û—Ç–º–µ–Ω—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç—ã –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Å–æ–±—ã—Ç–∏—è
        if (currentEvent === 'rain') {
            plots.forEach(plot => {
                if (plot.plant && plot.growthStart) {
                    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –Ω–æ—Ä–º–∞–ª—å–Ω—É—é —Å–∫–æ—Ä–æ—Å—Ç—å —Ä–æ—Å—Ç–∞
                    plot.growthStart = new Date(plot.growthStart.getTime() + plantGrowTime(plot.plant) * 500);
                }
            });
        }
        
        currentEvent = null;
    }
    
    if (random < 70) {
        // 70% - –æ–±—ã—á–Ω—ã–π –¥–µ–Ω—å
        showMessage('–°–µ–≥–æ–¥–Ω—è –æ–±—ã—á–Ω—ã–π –¥–µ–Ω—å');
    } else if (random < 95) {
        // 25% - –¥–æ–∂–¥—å
        currentEvent = 'rain';
        document.getElementById('event-indicator').textContent = '–ò–î–Å–¢ –î–û–ñ–î–¨: —Ä–∞—Å—Ç–µ–Ω–∏—è —Ä–∞—Å—Ç—É—Ç –≤ 2 —Ä–∞–∑–∞ –±—ã—Å—Ç—Ä–µ–µ!';
        document.getElementById('event-indicator').className = 'rain';
        showMessage('–ü–æ—à—ë–ª –¥–æ–∂–¥—å! –†–∞—Å—Ç–µ–Ω–∏—è —Ä–∞—Å—Ç—É—Ç –±—ã—Å—Ç—Ä–µ–µ!');
        
        // –£—Å–∫–æ—Ä—è–µ–º —Ä–æ—Å—Ç –≤—Å–µ—Ö —Ä–∞—Å—Ç–µ–Ω–∏–π
        plots.forEach(plot => {
            if (plot.plant && plot.growthStart) {
                plot.growthStart = new Date(plot.growthStart.getTime() - plantGrowTime(plot.plant) * 500);
            }
        });
    } else {
        // 5% - –≥—Ä–æ–∑–∞
        currentEvent = 'storm';
        document.getElementById('event-indicator').textContent = '–ì–†–û–ó–ê: –æ–¥–Ω–æ —Ä–∞—Å—Ç–µ–Ω–∏–µ –ø–æ–ª—É—á–∏—Ç —ç–Ω–µ—Ä–≥–∏—é!';
        document.getElementById('event-indicator').className = 'storm';
        showMessage('–ù–∞—á–∞–ª–∞—Å—å –≥—Ä–æ–∑–∞! –û–¥–Ω–æ —Ä–∞—Å—Ç–µ–Ω–∏–µ –ø–æ–ª—É—á–∏—Ç —ç–Ω–µ—Ä–≥–∏—é!');
        
        // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ —Ä–∞—Å—Ç–µ–Ω–∏–µ –¥–ª—è —ç–Ω–µ—Ä–≥–∏–∏
        const plantsWithIndex = plots.map((plot, index) => ({plot, index})).filter(p => p.plot.plant);
        if (plantsWithIndex.length > 0) {
            const randomPlant = plantsWithIndex[Math.floor(Math.random() * plantsWithIndex.length)];
            randomPlant.plot.hasEnergy = true;
            energyPlants[randomPlant.index] = true;
            updatePlant(randomPlant.plot);
            showMessage(`${plantName(randomPlant.plot.plant)} –ø–æ–ª—É—á–∏–ª(–∞) —ç–Ω–µ—Ä–≥–∏—é!`);
        }
    }
}

// 4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ isGrown –¥–ª—è —É—á–µ—Ç–∞ –ø–æ–ª–∏–≤–∞
function isGrown(plot) {
    if (!plot.growthStart) return false;
    const growTime = plantGrowTime(plot.plant) * 1000;
    const now = new Date();
    return now - plot.growthStart >= growTime;
}

// 5. –î–æ–±–∞–≤—å—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥ –≤ —Å–∞–º–æ–º –∫–æ–Ω—Ü–µ, –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã–≤–∞—é—â–∏–º —Ç–µ–≥–æ–º </script>
console.log("–í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã!");
    </script>
</body>
</html>
